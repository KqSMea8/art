<extend name="Public:base" />
<block name="content">
    <style type="text/css">
        td{
            padding: 5px 0px;
            margin: 0px;
        }
        label{
            min-width: 60px;
            display:inline-block;
        }


    </style>
    <div class="row" style="min-width: 1400px">
        <div class="col-lg-12">
            <div class="panel panel-default">
              <div class="panel-heading">
                艺术家管理
              </div>
                <div class="panel-heading">
                    <div class="row">
                        <form action="{:U('User/artist')}" class="form-inline" >
                            <div class="col-lg-12">
                                <div class="form-group">
                                    <label for="">关键字</label>
                                    <input type="text" name="keyword" class="form-control" value="{:I('keyword')}" >
                                </div>
                                <button class="btn btn-default form-control" type="submit">查看</button>
                            </div><!-- /.col-lg-6 -->
                            <div class="col-lg-12" style="height: 15px;"></div>
                            <div class="col-lg-12">
                                <div class="form-group">
                                    <label for="">显示列</label>
                                    <input type="checkbox" name="column[]" value="id" id="id" <?php if(in_array('id',I('column'))) echo checked;?>>用户ID
                                    <input type="checkbox" name="column[]" value="idno" id="idno" <?php if(in_array('idno',I('column'))) echo checked;?>>用户身份证号
                                    <input type="checkbox" name="column[]" value="invite_total" id="invite_total" <?php if(in_array('invite_total',I('column'))) echo checked;?>>邀请艺术家个数
                                    <input type="checkbox" name="column[]" value="cover" id="cover" <?php if(in_array('cover',I('column'))) echo checked;?>>画廊封面
                                    <input type="checkbox" name="column[]" value="mobile" id="mobile" <?php if(in_array('mobile',I('column'))) echo checked;?>>手机号码
                                    <input type="checkbox" name="column[]" value="show_gender" id="show_gender" <?php if(in_array('show_gender',I('column'))) echo checked;?>>性别
                                    <input type="checkbox" name="column[]" value="view_total" id="view_total" <?php if(in_array('view_total',I('column'))) echo checked;?>>画廊浏览数
                                    <input type="checkbox" name="column[]" value="is_art_show" id="is_art_show" <?php if(in_array('is_art_show',I('column'))) echo checked;?>>是否办微画展
                                    <input type="checkbox" name="column[]" value="is_interview" id="is_interview" <?php if(in_array('is_interview',I('column'))) echo checked;?>>是否办微专访
                                    <input type="checkbox" name="column[]" value="is_pa_show" id="is_pa_show" <?php if(in_array('is_pa_show',I('column'))) echo checked;?>>是否办PA画展
                                    <input type="checkbox" name="column[]" value="is_wechat_friend" id="is_wechat_friend" <?php if(in_array('is_wechat_friend',I('column'))) echo checked;?>>是否添加微信好友
                                    <input type="checkbox" name="column[]" value="address" id="address" <?php if(in_array('address',I('column'))) echo checked;?>>地址
                                    <input type="checkbox" name="column[]" value="login_times" id="login_times" <?php if(in_array('login_times',I('column'))) echo checked;?>>登陆次数
                                </div>
                            </div><!-- /.col-lg-6 -->
                        </form>

                   </div><!-- /.row -->
                </div>
                <!-- /.panel-heading -->
                <div style="width: 100%;overflow: auto" class="panel-body">
                    <table style="width: 100%" class="table table-striped table-bordered table-hover" >
                        <thead>
                        <tr>
                            <th <?php if(in_array('id',I('column'))){} else echo hidden;?>>用户ID</th>
                            <th>用户昵称</th>
                            <th>用户真实姓名</th>
                            <th>用户头像</th>
                            <th>画廊画作数</th>
                            <th>画廊粉丝数</th>
                            <th>最近一次登陆时间</th>

                            <th <?php if(in_array('idno',I('column'))){} else echo hidden;?>>用户身份证号</th>
                            <th <?php if(in_array('invite_total',I('column'))){} else echo hidden;?>>邀请艺术家个数</th>
                            <th <?php if(in_array('cover',I('column'))){} else echo hidden;?>>画廊封面</th>
                            <th <?php if(in_array('mobile',I('column'))){} else echo hidden;?>>手机号码</th>
                            <th <?php if(in_array('show_gender',I('column'))){} else echo hidden;?>>性别</th>
                            <th <?php if(in_array('view_total',I('column'))){} else echo hidden;?>>画廊浏览数</th>
                            <th <?php if(in_array('is_art_show',I('column'))){} else echo hidden;?>>是否办微画展</th>
                            <th <?php if(in_array('is_interview',I('column'))){} else echo hidden;?>>是否办微专访</th>
                            <th <?php if(in_array('is_pa_show',I('column'))){} else echo hidden;?>>是否办PA画展</th>
                            <th <?php if(in_array('is_wechat_friend',I('column'))){} else echo hidden;?>>是否添加微信好友</th>
                            <th <?php if(in_array('address',I('column'))){} else echo hidden;?>>地址</th>
                            <th <?php if(in_array('login_times',I('column'))){} else echo hidden;?>>登陆次数</th>
                            <th style="width: 50px">操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <foreach name="lists" item="user" key="k" >
                            <tr>
                                <td <?php if(in_array('id',I('column'))){} else echo hidden;?>>{$user['id']}</td>
                                <td style="max-width: 80px;word-wrap:break-word">
                                    <a href="{:U('Admin/User/showDetail',['id'=>$user['id'],'page'=>$page])}">{$user['nickname']}</a>
                                </td>
                                <td>
                                    <a href="{:U('Admin/User/showDetail',['id'=>$user['id'],'page'=>$page])}">{$user['truename']}</a>
                                </td>
                                <td>
                                    <if condition="$user['face'] == '' ">
                                        <else />
                                        <img src="{$user['face']}" alt="" style="width:100px;height: 100px;">
                                    </if>
                                </td>
                                <td>{$user['gallery_art_total']}</td>
                                <td>{$user['follower_total']}</td>
                                <td>{$user['last_login_time']}</td>

                                <td style="max-width: 80px;word-wrap:break-word" <?php if(in_array('idno',I('column'))){} else echo hidden;?>>{$user['IDNO']}</td>
                                <td <?php if(in_array('invite_total',I('column'))){} else echo hidden;?>>{$user['invite_total']}</td>
                                <td <?php if(in_array('cover',I('column'))){} else echo hidden;?>>
                                    <if condition="$user['cover'] == '' ">
                                        <else />
                                        <img src="{$user['cover']}" alt="" style="width:100px;height: 100px;">
                                    </if>
                                </td>
                                <td style="max-width: 80px;word-wrap:break-word" <?php if(in_array('mobile',I('column'))){} else echo hidden;?>>{$user['mobile']}</td>
                                <td <?php if(in_array('show_gender',I('column'))){} else echo hidden;?>>{$user['show_gender']}</td>
                                <td <?php if(in_array('view_total',I('column'))){} else echo hidden;?>>{$user['view_total']}</td>
                                <td <?php if(in_array('is_art_show',I('column'))){} else echo hidden;?>>{$user['is_art_show']}</td>
                                <td <?php if(in_array('is_interview',I('column'))){} else echo hidden;?>>{$user['is_interview']}</td>
                                <td <?php if(in_array('is_pa_show',I('column'))){} else echo hidden;?>>{$user['is_pa_show']}</td>
                                <td <?php if(in_array('is_wechat_friend',I('column'))){} else echo hidden;?>>{$user['is_wechat_friend']}</td>
                                <td <?php if(in_array('address',I('column'))){} else echo hidden;?>>{$user['address']}</td>
                                <td <?php if(in_array('login_times',I('column'))){} else echo hidden;?>>{$user['login_times']}</td>
                                <td>
                                    <a href="{:U('Admin/User/showDetail',['id'=>$user['id'],'page'=>$page])}">详情</a>&nbsp;
                                </td>
                            </tr>
                        </foreach>
                        </tbody>
                    </table>
                    <!-- /.table-responsive -->
                    <!-- TODO:page -->
                    {$nav}
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-12 -->
    </div>
</block>
<block name="customJs">
    <script>
         $(document).ready(function(){
             /*$('#az-id-date-selector').datetimepicker({
                format:'yyyy-mm-dd',
                 language:  'zh-CN',
                 weekStart: 1,
                 todayBtn:  1,
                autoclose: 1,
                todayHighlight: 1,
                 startView: 2,
                minView: 2,
                forceParse: 0
             })*/


             $('.number').bind('input propertychange', function() {
                 var re = /^0+$/;
                 var re1 = /^[0-9]/;
                 if (re.test($(this).val()) || $(this).val()<0 || !re1.test($(this).val())) {
                     $(this).val('0');
                 }
             });

             //默认绑定省
             provinceBind();
             var province = "<?php echo I('province');?>";
             if(province>0) {
                 $("#province").val(province);
                 cityBind();
             }
             var city = "<?php echo I('city');?>";
             if(city>0) {
                 $("#city").val(city);
                 areaBind();
             }
             var area = "<?php echo I('area');?>";
             if(area>0) {
                 $("#area").val(area);
             }
             //绑定事件
             $("#province").change( function () {
                 $("#city").html("<option selected>请选择</option>");
                 $("#area").html("<option selected>请选择</option>");
                 cityBind();
             })

             $("#city").change(function () {
                 $("#area").html("<option selected>请选择</option>");
                 areaBind();
             })

         });

         function provinceBind() {
             $("#province").html("");
             var str = "<option selected>请选择</option>";
             $.ajax({
                 type: "POST",
                 url: '<?php echo U('User/getAddress');?>',
                 data: {"level": "1","pid":"0"},
                 dataType: "JSON",
                 async: false,
                 success: function (data) {
                     if (data.error == 0) {
                         $.each(data.data, function (i, item) {
                             str += "<option value=" + item.id + ">" + item.aname + "</option>";
                         });
                         $("#province").append(str);

                     }else{
                         $.prompt("<span style=\" color:#F00\">"+data.message+"</span>", {
                             title: "提示",
                             buttons: {"确定": false}
                         });
                     }

                 },
                 error: function () {
                     $.prompt("<span style=\" color:#AD6C14\">"+error+"</span>", {
                         title: "提示",
                         buttons: {"确定": false}
                     });
                 }
             });
         }

         function cityBind() {
             var provice = $("#province").val();
             if (provice == "") {
                 return;
             }
             $("#city").html("");
             var str = "<option selected>请选择</option>";
             $.ajax({
                 type: "POST",
                 url: '<?php echo U('User/getAddress');?>',
                 data: {"level": "2","pid":provice},
                 dataType: "JSON",
                 async: false,
                 success: function (data) {
                     if (data.error == 0) {
                         $.each(data.data, function (i, item) {
                             str += "<option value=" + item.id + ">" + item.aname + "</option>";
                         });
                         $("#city").append(str);

                     }else{
                         $.prompt("<span style=\" color:#F00\">"+data.message+"</span>", {
                             title: "提示",
                             buttons: {"确定": false}
                         });
                     }

                 },
                 error: function () {
                     $.prompt("<span style=\" color:#AD6C14\">"+error+"</span>", {
                         title: "提示",
                         buttons: {"确定": false}
                     });
                 }
             });
         }

         function areaBind() {
             var provice = $("#city").val();
             if (provice == "") {
                 return;
             }
             $("#area").html("");
             var str = "<option selected>请选择</option>";
             $.ajax({
                 type: "POST",
                 url: '<?php echo U('User/getAddress');?>',
                 data: {"level": "3","pid":provice},
                 dataType: "JSON",
                 async: false,
                 success: function (data) {
                     if (data.error == 0) {
                         $.each(data.data, function (i, item) {
                             str += "<option value=" + item.id + ">" + item.aname + "</option>";
                         });
                         $("#area").append(str);
                     }else{
                         $.prompt("<span style=\" color:#F00\">"+data.message+"</span>", {
                             title: "提示",
                             buttons: {"确定": false}
                         });
                     }

                 },
                 error: function () {
                     $.prompt("<span style=\" color:#AD6C14\">"+error+"</span>", {
                         title: "提示",
                         buttons: {"确定": false}
                     });
                 }
             });
         }

        function checkPhone(value){
            if(value!=""){
                var re = /^1\d{10}$/
                if (re.test(value)) {

                } else {
                    $.prompt("<span style=\" color:#AD6C14\">手机号格式错误!</span>", {
                        title: "提示",
                        buttons: {"确定": false}
                    });
                }
            }
        }

        function checkForm(){
            var mobile = $("#mobile").val();
            var sRegistTime = $("#sRegistTime").val();
            var eRegistTime = $("#eRegistTime").val();
            var sLastLoginTime = $("#sLastLoginTime").val();
            var eLastLoginTime = $("#eLastLoginTime").val();
            var sLoginCount = $("#sLoginCount").val();
            var eLoginCount = $("#eLoginCount").val();
            var sFollowerTotal = $("#sFollowerTotal").val();
            var eFollowerTotal = $("#eFollowerTotal").val();
            var check = true;
            var message = "";
            if ($.trim(mobile) != '') {
                var re = /^1\d{10}$/
                if (re.test(mobile)) {

                } else {
                    check = false;
                }
                message = message + "<li>手机号格式错误!</li>";
            }
            if(sRegistTime!='' && eRegistTime!='' && sRegistTime>eRegistTime){
                var check = false;
                message = message + "<li>开始注册时间不能晚于结束注册时间!</li>";
            }

            if(sLastLoginTime!='' && eLastLoginTime!='' && sLastLoginTime>eLastLoginTime){
                var check = false;
                message = message + "<li>开始登录时间不能晚于结束登录时间!</li>";
            }
            if(sLoginCount!='' && eLoginCount!='' && eLoginCount>0 && sLoginCount-eLoginCount>0){
                var check = false;
                message = message + "<li>开始登录次数不能大于结束登录次数!</li>";
            }
            if(sFollowerTotal!='' && eFollowerTotal!='' && eFollowerTotal>0 && sFollowerTotal-eFollowerTotal>0){
                var check = false;
                message = message + "<li>开始画廊粉丝数不能大于结束画廊粉丝数!</li>";
            }
            if (check == false) {
                $.prompt("<span style=\" color:#AD6C14\">"+message+"</span>", {
                    title: "提示",
                    buttons: {"确定": false}
                });
                return false;
            } else {
                return true;
            }

        }
    </script>
</block>
