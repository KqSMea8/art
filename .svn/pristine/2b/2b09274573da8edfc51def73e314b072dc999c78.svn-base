<extend name="Public:base" />
<block name="content">
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
              <div class="panel-heading">
                用户浏览统计
              </div>
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-lg-12">
                            <form action="{:U('Statistics/index')}" class="form-inline" onsubmit="return checkDate();">
                                <div class="form-group">
                                  <label for="">时间</label>
                                  <input type="date" name="sTime" id="sTime" class="form-control" value="{$queryParam['sTime']|date='Y-m-d',###}" min="2017-01-01" max="{:date('Y-m-d')}">
                                  --
                                  <input type="date" name="eTime" id="eTime" class="form-control" value="{$queryParam['eTime']|date='Y-m-d',###}" min="2017-01-01" max="{:date('Y-m-d')}">
                                </div>
                                <button class="btn btn-default form-control" type="submit" id="statistics">统计</button>
                            </form>
                        </div><!-- /.col-lg-6 -->
                    </div><!-- /.row -->
                </div>
                <!-- /.panel-heading -->
                <div style="width: 100%;overflow: auto" class="panel-body">
                    <table style="width: auto" class="table table-striped table-bordered table-hover" >
                        <thead>
                        <tr>
                            <th>用户名称</th>
                            <th>访问频率</th>
                            <th>最近访问时间</th>
                            <th>访问页面AVG(个)</th>
                            <th>app AVG(分)</th>
                            <th>艺术号详情AVG(秒)</th>
                            <th>花絮详情AVG(秒)</th>
                            <th>专题详情AVG(秒)</th>
                            <th>推荐列表AVG(秒)</th>
                            <th>花絮列表AVG(秒)</th>
                            <th>艺术家列表AVG(秒)</th>
                            <th>画作列表AVG(秒)</th>
                            <th>专题列表AVG(秒)</th>
                            <th>艺术圈列表AVG(秒)</th>
                            <th>商城列表AVG(秒)</th>
                            <th>艺术号列表AVG(秒)</th>
                            <foreach name="articleColumm" item="colum" key="k" >
                                <th>艺术号{$colum}AVG(秒)</th>
                            </foreach>

                        </tr>
                        </thead>
                        <tbody>
                        <foreach name="lists" item="data" key="k" >
                            <tr>
                                <td>{$data['nickname']}</td>
                                <td>{$data['visits']}</td>
                                <td>{$data['recent_time']|date='Y-m-d H:i',###}</td>
                                <td>{$data['app_avg_pages']}</td>
                                <td>{$data['app_avg_time']}</td>
                                <td>{$data['article_detail_avg_time']}</td>
                                <td>{$data['update_detail_avg_time']}</td>
                                <td>{$data['subject_detail_avg_time']}</td>
                                <td>{$data['recommend_avg_time']}</td>
                                <td>{$data['update_avg_time']}</td>
                                <td>{$data['artist_avg_time']}</td>
                                <td>{$data['artwork_avg_time']}</td>
                                <td>{$data['subject_avg_time']}</td>
                                <td>{$data['artcircle_avg_time']}</td>
                                <td>{$data['mall_avg_time']}</td>
                                <td>{$data['article_avg_time']}</td>
                                <foreach name="articleColumm" item="colum" key="ck" >
                                    <td>{$data[$ck]}</td>
                                </foreach>
                            </tr>
                        </foreach>
                        </tbody>
                    </table>
                    <!-- /.table-responsive -->
                    <!-- TODO:page -->
                    {$nav}
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-12 -->
    </div>
</block>
<block name="customJs">
    <script>
        $(document).ready(function(){

        });

        function checkDate(){
            var sTime  = $("#sTime").val();
            var eTime  = $("#eTime").val();
            check = true;
            var message = "";
            if(sTime!='' && eTime!='' && sTime>eTime){
                var check = false;
                message = message + "<li>开始时间不能晚于结束时间!</li>";
            }

            if (check == false) {
                $.prompt("<span style=\" color:#AD6C14\">"+message+"</span>", {
                    title: "提示",
                    buttons: {"确定": false}
                });
                return false;
            } else {
                $.ajax({
                    type: "POST",
                    url: '/Admin/Statistics/visit', //发送手机验证码
                    data: {
                        'sTime': sTime,
                        'eTime': eTime
                    },
                    success: function(res) {
                        //window.location.reload();
                        window.location.href = "../Statistics/visit?sTime="+sTime+"&eTime="+eTime;
                    }
                });
                return false;
            }
            return false;
        }
    </script>
</block>
