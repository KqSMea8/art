<extend name="Public:base" />
<style type="text/css" rel="stylesheet">
    div.row {
        margin-bottom: 10px;
    }
</style>
<block name="content">
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    申请列表审核
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-2">申请时间</div><div class="col-md-10">{$list['create_time']|date="Y-m-d H:i:s",###}</div>
                    </div>
                    <div class="row">
                        <div class="col-md-2">申请者</div><div class="col-md-10">{$list['username']}</div>
                    </div>
                    <div class="row">
                        <div class="col-md-2">画作</div><div class="col-md-10">{$list['artname']}</div>
                    </div>
                    <div class="row">
                        <div class="col-md-2">画作寄语</div><div class="col-md-10">{$list['description']}</div>
                    </div>
                    <if condition="$list['status'] eq 2">
                        <div class="row">
                            <div class="col-md-2">审核状态</div><div class="col-md-10">审核通过</div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">处理时间</div><div class="col-md-10">{$list['check_time']|date="Y-m-d H:i:s",###}</div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">审核者备注</div><div class="col-md-10">{$list['memo']|default='无'}</div>
                        </div>
                        <elseif condition="$list['status'] eq -1 "/>
                        <div class="row">
                                <div class="col-md-2">审核状态</div><div class="col-md-10">审核未通过</div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">处理时间</div><div class="col-md-10">{$list['check_time']|date="Y-m-d H:i:s",###}</div>
                        </div>
                        <div class="row">
                            <div class="col-md-2">审核者备注</div><div class="col-md-10">{$list['memo']|default='无'}</div>
                        </div>
                        <else />
                        <form method="post" action="{:U('Admin/Subject/verify')}" id="az-verify-form">
                            <div class="row">
                                <div class="col-md-2">审核状态</div>
                                <div class="col-md-10">
                                    <select name="verifyState">
                                        <option value="1" selected>审核中</option>
                                        <option value="-1">审核未通过</option>
                                        <option value="2">审核通过</option>
                                    </select>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2">审核者备注</div>
                                <div class="col-md-10">
                                    <textarea name="verifyMemo" placeholder="请备注通过或不通过原因，便于电话回访。" cols="50" rows="10"></textarea>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-2"></div>
                                <div class="col-md-10">
                                    <a href="#" class="btn btn-success btn-sm" data-toggle="modal" data-target="#az-id-modal" id="az-btn-submit">提交</a>
                                </div>
                            </div>
                            <input type="hidden" name="id" value="{$list['id']}">
                        </form>
                    </if>

                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.col-lg-12 -->
            <!-- /.panel -->
          <!--  <a href="{:U('Subject/applylist')}" class="btn btn-default">返回</a>-->
        </div>
    </div>
    <div class="modal fade" id="az-id-modal" tabindex="-1" role="dialog" aria-labelledby="az-label-modal">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="az-label-modal">温馨提示</h4>
                </div>
                <div class="modal-body">
                    该用户的画作将通过主题审核，是否确认通过？
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                    <button type="button" class="btn btn-success" id="az-id-btn-ok">确定</button>
                </div>
            </div>
        </div>
    </div>
</block>
<block name="customJs">
    <script >
        $(document).ready(function () {
            $('.az-image-popup').magnificPopup({
                type:"image"
            });
            $('.az-cls-popup-cert').magnificPopup({
                delegate: 'a',
                type: 'image',
                tLoading: 'Loading image #%curr%...',
                mainClass: 'mfp-img-mobile',
                gallery: {
                    enabled: true,
                    navigateByImgClick: true,
                    preload: [0,1] // Will preload 0 - before current, and 1 after the current image
                }
            });
            $('.az-cls-popup-group').magnificPopup({
                delegate: 'a',
                type: 'image',
                tLoading: 'Loading image #%curr%...',
                mainClass: 'mfp-img-mobile',
                gallery: {
                    enabled: true,
                    navigateByImgClick: true,
                    preload: [0,1] // Will preload 0 - before current, and 1 after the current image
                }
            });
            $('#az-btn-submit').click(function () {
                var state = $("select[name=verifyState]").val();
                if (state == 1) {

                }
            });
            $("#az-id-modal").on('show.bs.modal', function (e) {
                var modal = $(this);
                var state = $("select[name=verifyState]").val();
                if (state == 1) {
                    modal.find('.modal-body').text('你还未审核！');
                    modal.find('.modal-footer').hide();
                } else if(state == -1)
                {
                    modal.find('.modal-body').text('该用户的画作将不通过主题审核，确定此操作吗？');
                    modal.find('.modal-footer').show();
                } else if (state == 2)
                {
                    modal.find('.modal-body').text('该用户的画作将通过主题审核，确定此操作吗？');
                    modal.find('.modal-footer').show();
                } else {
                    return false;
                }
            });
            $('#az-id-btn-ok').click(function () {
                $('#az-verify-form').submit();
            });
        })
    </script>
</block>