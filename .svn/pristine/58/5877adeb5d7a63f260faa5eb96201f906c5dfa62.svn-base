<?php

namespace Api\Controller;

use Think\Controller;
use Custom\Define\Code;
use Custom\Helper\Util;
use OSS\OssClient;

class FileController extends Controller{

    //图片上传
    public function upimg(){

        if($_FILES['imgurl']['error'] == 4){
            Util::ajaxReturn(['status'=>Code::PARAM_ERR, 'info'=>'没有上传图片']);
        }

        $imgurl = file_get_contents($_FILES['imgurl']['tmp_name']);; //获取图片上传url

        $ossConfig = C('OSS'); //获取OSS配置信息
        $ossClient = new OssClient($ossConfig['appKeyId'], $ossConfig['appKeySecret'],$ossConfig['endPoint']);
        $filename = time().rand(100,999); //设置文件名
        $result  = $ossClient->putObject($ossConfig['bucket'], 'uploads/'.date('Y/m/d').'/'.$filename.'.'.'jpg', $imgurl);
        $info = $result['info']['url'];

        Util::ajaxReturn(['status'=>Code::SUCCESS, 'url'=>$info]);
    }
}