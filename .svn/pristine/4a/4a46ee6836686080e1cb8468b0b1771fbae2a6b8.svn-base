<extend name="Public:base"/>
<block name="content">
    <style type="text/css">
        .navbar-static-top {
            z-index: 998;
        }
    </style>
    <link href="/Public/Admin/js/thickbox/thickbox.css" rel="stylesheet">
    <link href="/Public/Admin/js/jquery-impromptu/jquery-impromptu.css" rel="stylesheet">
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                    添加用户
                </div>
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-lg-12">

                        </div><!-- /.col-lg-6 -->
                    </div><!-- /.row -->
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <form id="post_from" name="post_from" method="post" action="<?php echo U('User/adduser'); ?>">
                        <table width="100%" class="table table-striped table-bordered table-hover">
                            <thead>
                            <tr>
                                <th width="100"></th>
                                <th width="419">&nbsp;</th>
                            </tr>
                            </thead>
                            <tbody>
                            </tbody>
                            <tr>
                                <td>用户昵称</td>
                                <td><input name="nickname" type="text" id="nickname" size="40"/></td>
                            </tr>
                            <tr>
                                <td>手机</td>
                                <td><input name="mobile" type="text" id="mobile" value="91916" size="40"
                                           maxlength="11"/>
                                    <span style=" color:#F00">艺术者自有账号开头：91916</span></td>
                            </tr>
                            <tr>
                                <td>密码</td>
                                <td><input name="password" type="text" id="password" value="qqwwee2017"/></td>
                            </tr>
                            <tr>
                                <td>头像</td>
                                <td><input type="file" id="face" name="face"></td>
                            </tr>
                            <tr>
                                <td>motto</td>
                                <td><textarea name="motto" id="motto" cols="45" rows="5"></textarea></td>
                            </tr>
                            <tr>
                                <td>是否机构</td>
                                <td><input name="is_agency" type="checkbox" id="is_agency" value="1" <?php if($_GET['agency']==1)echo 'checked="checked"';?>/></td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td><input type="submit" name="button" id="button" value="生成账号"/>
                                    <div id="ajax_loading"></div>
                                </td>
                            </tr>
                        </table>
                    </form>
                    <!-- /.table-responsive -->
                    {$nav}
                    <!-- TODO:page -->
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-12 -->
    </div>
</block>
<block name="customJs">
    <script language="javascript" type="text/javascript" src="/Public/Admin/js/thickbox/thickbox.js"></script>
    <script language="javascript" type="text/javascript" src="/Public/Admin/js/jquery.form.js"></script>
    <script language="javascript" type="text/javascript"
            src="/Public/Admin/js/jquery-impromptu/jquery-impromptu.js"></script>

    <script type="text/javascript">

        var options = {
            target: '#output',          //把服务器返回的内容放入id为output的元素中
            beforeSubmit: showRequest,  //提交前的回调函数
            success: showResponse,      //提交后的回调函数
            //url: url,                 //默认是form的action， 如果申明，则会覆盖
            //type: type,               //默认是form的method（get or post），如果申明，则会覆盖
            dataType: 'json',           //html(默认), xml, script, json...接受服务端返回的类型
            //clearForm: true,          //成功提交后，清除所有表单元素的值
            //resetForm: true,          //成功提交后，重置所有表单元素的值
            //timeout: 3000               //限制请求的时间，当请求大于3秒后，跳出请求
        }
        function showRequest(formData, jqForm, options) {
            var nickname = $("#nickname").val();
            var mobile = $("#mobile").val();
            var password = $("#password").val();
            var face = $("#face").val();
            var is_agency = $("input[name='is_agency']:checked").val();


            var check = true;
            var message = "";
            if ($.trim(nickname) == '') {
                check = false;
                message = message + "<li>昵称不能为空</li>";
            }
            if ($.trim(mobile) == '') {
                check = false;
                message = message + "<li>手机不能为空</li>";
            }

            if ($.trim(password) == '') {
                check = false;
                message = message + "<li>密码不能为空</li>";
            }
            if ($.trim(face) == '') {
                check = false;
                message = message + "<li>请选择头像</li>";
            } else if (!IsPicture(face)) {
                check = false;
                message = message + "<li>头像请选择图片</li>";
            }


            if (check == false) {
                $.prompt("<span style=\" color:#AD6C14\">" + message + "</span>", {
                    title: "提示",
                    buttons: {"确定": false}
                });
                return false;
            } else {
                $("#ajax_loading").html("<img id='loading_select' src='/Public/Admin/image/loading.gif' /> ");
                return true;
            }
        };

        function showResponse(responseText, statusText) {

            if (responseText.error == 0) {


                $.prompt("完成！", {
                    title: "提示",
                    buttons: {"确定": true},
                    submit: function (e, v, m, f) {

                        if (v == true) {
                            window.location.href = "{:U('User/index')}";
                        }
                    }
                });

            } else {
 $("#ajax_loading").html("");
                $.prompt("<span style=\" color:#F00\">" + responseText.message + "</span>", {
                    title: "提示",
                    buttons: {"确定": false}
                });
            }
        };

        $("#post_from").ajaxForm(options);


        function IsPicture(picName) {
            if (!/\.(gif|jpg|jpeg|png|GIF|JPG|PNG)$/.test(picName)) {
                return false;
            }
            return true;
        }


        $('input[name="shape"]').each(function () {
            $(this).prop("checked", false);
        });
    </script>


</block>
