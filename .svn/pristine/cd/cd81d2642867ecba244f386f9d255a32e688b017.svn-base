var vmApp = new Vue({
  el: '#app',
  data: {
    isClickgetVerify: false,
    getVerifyCodeText: '获取验证码',
    count: 60,
    errorTip: 'errorText',
    formData: {
      mobile: '',
      imgCode: ''
    },
    isSubmit: false
  },
  methods: {
    submitForm: function (formName) {
      var that = this;
      var mobile = this.formData.mobile;
      var imgCode = this.formData.imgCode;
      if (mobile == "") {
        this.errorTip = "请输入您的手机号";
        return false;
      } else if (!validInfo.mobile.test(mobile)) {
        this.errorTip = "请输入正确的手机号";
        return false;
      } else if (imgCode == "") {
        this.errorTip = "请输入验证码";
        return false;
      }
      //避免重复点击提交
      if (this.isSubmit) {
        return false;
      }
      this.isSubmit = true;

      // TipsShow.showtips({
      //   info: "提交中,请稍后..."
      // });
      artzheAgent.call('user/isAccount',this.formData,function(res) {
        that.isSubmit = false;
        console.log(res);
        if (res.code == 30000) {
          if (res.data.isAccount == 'N') {
            setCookie('regMobile', this.formData.mobile);
            window.location.href = '/home/register/second';
          } else {

          }
        } else if (res.code == 30111) {
          that.errorTip = "密码错误";
        }
      });
    },
    getVerifyCode: function () {
      console.log('getVerifyCode');
      var that = this;
      var data = {
        mobile: this.ruleForm.mobile
      };
      this.$refs['ruleForm'].validateField('mobile',
        function (errorMsg) {
          if (errorMsg) {
            console.log(errorMsg);
          } else {
          console.log('haha');
          if (that.isClickgetVerify) {
            return false;
          }
          that.setTime();
          artzheAgent.call('user/sendVerifyCode', data,function(res) {
            console.log(res);
            if (res.code == 30000) {

            }
          });
          return false;
        }
      });
    },
    setTime: function (argument) {
      var that = this;
      var count = this.count;
      if (this.count == 0) {
        this.isClickgetVerify = false;
        this.getVerifyCodeText = "重新发送";
        this.count = 60;
        return false;
      } else {
        this.isClickgetVerify = true;
        this.getVerifyCodeText = this.count + "S";
        this.count = --count;
        // console.log(this.count);
      }
      setTimeout(function() {
        that.setTime();
      }, 1000);
    }
  }
});