<extend name="Public:base" />
<block name="content">
    <div class="row">
        <div class="col-lg-12">
            <div class="panel panel-default">
                <div class="panel-heading">
                更新管理
                </div>
                <div class="panel-heading">
                    <div class="row">
                            <form action="{:U('Art/artUpdate')}" class="form-inline" onsubmit="return checkForm();">
                                <div class="col-lg-12">
                                    <div class="form-group">
                                      <label for="">关键字</label>
                                      <input type="text" name="keyword" class="form-control" value="{:I('keyword')}" >
                                    </div>
                                    <button class="btn btn-default form-control" type="submit">查看</button>
                                </div><!-- /.col-lg-6 -->
                                <div class="col-lg-12" style="height: 15px;"></div>
                                <div class="col-lg-12">
                                    <div class="form-group">
                                        <label for="">显示列</label>
                                        <input type="checkbox" name="column[]" value="title" id="title" <?php if(in_array('title',I('column'))) echo checked;?>>花絮标题
                                        <input type="checkbox" name="column[]" value="tag" id="tag" <?php if(in_array('tag',I('column'))) echo checked;?>>花絮标签
                                        <input type="checkbox" name="column[]" value="like_total" id="like_total" <?php if(in_array('like_total',I('column'))) echo checked;?>>喜欢数
                                        <input type="checkbox" name="column[]" value="comment_total" id="comment_total" <?php if(in_array('comment_total',I('column'))) echo checked;?>>评论数
                                        <input type="checkbox" name="column[]" value="view_total" id="view_total" <?php if(in_array('view_total',I('column'))) echo checked;?>>浏览数
                                    </div>
                                </div><!-- /.col-lg-6 -->

                               <!-- <div class="form-group">
                                  <label for="">用户名称</label>
                                  <input type="text" name="artistname" class="form-control" value="{:I('artistname')}">
                                </div>
                                <div class="form-group">
                                  <label for="">手机号码</label>
                                  <input type="text" id="mobile" name="mobile" class="form-control" value="{:I('mobile')}" maxlength="11" onchange="checkPhone(this.value)">
                                </div>
                                <div class="form-group">
                                  <label for="">创建时间</label>
                                  <input type="date" id="sCreateTime" name="sCreateTime" class="form-control" value="{:I('sCreateTime')}" min="2017-01-01" max="{:date('Y-m-d')}">
                                  --
                                  <input type="date" id="eCreateTime" name="eCreateTime" class="form-control" value="{:I('eCreateTime')}" min="2017-01-01" max="{:date('Y-m-d')}">
                                </div>
                                <div class="form-group">
                                  <label for="">浏览数</label>
                                  <input type="number" id="sViewTotal" name="sViewTotal" class="form-control number" value="{:I('sViewTotal')}" min="0">
                                  --
                                  <input type="number" id="eViewTotal" name="eViewTotal" class="form-control number" value="{:I('eViewTotal')}" min="0">
                                </div>
                                <div class="form-group">
                                  <label for="">喜欢数</label>
                                  <input type="number" id="sLikeTotal" name="sLikeTotal" class="form-control number" value="{:I('sLikeTotal')}" min="0">
                                  --
                                  <input type="number" id="eLikeTotal" name="eLikeTotal" class="form-control number" value="{:I('eLikeTotal')}" min="0">
                                </div>
                                <div class="form-group">
                                  <label for="">评论数</label>
                                  <input type="number" id="sCommentTotal" name="sCommentTotal" class="form-control number" value="{:I('sCommentTotal')}" min="0">
                                  --
                                  <input type="number" id="eCommentTotal" name="eCommentTotal" class="form-control number" value="{:I('eCommentTotal')}" min="0">
                                </div>-->
                        </form>
                    </div><!-- /.row -->
                </div>
                <!-- /.panel-heading -->
                <div class="panel-body">
                    <table width="100%" class="table table-striped table-bordered table-hover" >
                        <thead>
                        <tr>
                            <th>画作名称</th>
                            <th>艺术家</th>
                            <th>类型</th>
                            <th>更新第几次</th>
                            <th>创建时间</th>
                            <th>画作图片</th>
                            <!--隐藏部分-->
                            <th <?php if(in_array('title',I('column'))){} else echo hidden;?>>花絮标题</th>
                            <th <?php if(in_array('tag',I('column'))){} else echo hidden;?>>花絮标签</th>
                            <th <?php if(in_array('like_total',I('column'))){} else echo hidden;?>>喜欢数</th>
                            <th <?php if(in_array('comment_total',I('column'))){} else echo hidden;?>>评论数</th>
                            <th <?php if(in_array('view_total',I('column'))){} else echo hidden;?>>浏览数</th>
                            <!--隐藏部分-->
                            <th >操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        <foreach name="lists" item="up" key="k" >
                            <tr>
                                <td>
                                    <a href="{:U('Admin/Art/detail',['id'=>$up['artwork_id']])}">{$up['name']}</a>
                                </td>
                                <td>
                                    <a href="{:U('Admin/User/showDetail',['id'=>$up['artist']])}">{$up['nickname']}</a>
                                </td>
                                <td>
                                    <if condition="$up['type'] == 1 ">创作花絮
                                        <else /> 艺术圈花絮
                                    </if>
                                </td>
                                <td>{$up['number']}</td>
                                <td>{$up['create_time']}</td>
                                <td>
                                  <img src="{$up['cover']}" alt="" style="width:100px;">
                                </td>
                                <!--隐藏部分-->
                                <td <?php if(in_array('title',I('column'))){} else echo hidden;?>>{$up['title']}</td>
                                <td <?php if(in_array('tag',I('column'))){} else echo hidden;?>>{$up['tag']}</td>
                                <td <?php if(in_array('like_total',I('column'))){} else echo hidden;?>>{$up['like_total']}</td>
                                <td <?php if(in_array('comment_total',I('column'))){} else echo hidden;?>>{$up['comment_total']}</td>
                                <td <?php if(in_array('view_total',I('column'))){} else echo hidden;?>>{$up['view_total']}</td>
                                <!--隐藏部分-->
                                <td>
                                    <if condition="$up['type'] == 1 ">
                                        <a href="artUpdateDetail?id={$up['id']}">点击查看详情</a>
                                        <else />
                                        <a href="artCircleDetailTable?id={$up['id']}">点击查看详情</a>
                                    </if>
                                </td>
                            </tr>
                        </foreach>
                        </tbody>
                    </table>
                    <!-- /.table-responsive -->
                    <!-- TODO:page -->
                    {$nav}
                </div>
                <!-- /.panel-body -->
            </div>
            <!-- /.panel -->
        </div>
        <!-- /.col-lg-12 -->
    </div>
</block>
<block name="customJs">
    <script>
        $(document).ready(function(){
            /* $('#az-id-date-selector').datetimepicker({
             format:'yyyy-mm-dd',
             language:  'zh-CN',
             weekStart: 1,
             todayBtn:  1,
             autoclose: 1,
             todayHighlight: 1,
             startView: 2,
             minView: 2,
             forceParse: 0
             })*/

            $('.number').bind('input propertychange', function() {
                var re = /^0+$/;
                var re1 = /^[0-9]/;
                if (re.test($(this).val()) || $(this).val()<0 || !re1.test($(this).val())) {
                    $(this).val('0');
                }
            });



             /*  if(column){
                for (var i = 0; i < column.length; i) {
                    switch (column[i])
                    {
                        case "title":
                            $(".title").show();
                            break;
                        case "tag":
                            $(".tag").show();
                            break;
                        case "like_total":
                            $(".like_total").show();
                            break;
                        case "comment_total":
                            $(".comment_total").show();
                            break;
                        case "view_total":
                            $(".view_total").show();
                            break;
                    }
                }
            }
*/




        });

        function checkPhone(value){
            if(value!=""){
                var re = /^1\d{10}$/
                if (re.test(value)) {

                } else {
                    $.prompt("<span style=\" color:#AD6C14\">手机号格式错误!</span>", {
                        title: "提示",
                        buttons: {"确定": false}
                    });
                }
            }
        }

        function checkForm(){
            var mobile = $("#mobile").val();
            var sCreateTime = $("#sCreateTime").val();
            var eCreateTime = $("#eCreateTime").val();
            var sViewTotal = $("#sViewTotal").val();
            var eViewTotal = $("#eViewTotal").val();
            var sLikeTotal = $("#sLikeTotal").val();
            var eLikeTotal = $("#eLikeTotal").val();
            var sCommentTotal = $("#sCommentTotal").val();
            var eCommentTotal = $("#eCommentTotal").val();
            var check = true;
            var message = "";
            if ($.trim(mobile) != '') {
                var re = /^1\d{10}$/
                if (re.test(mobile)) {

                } else {
                    check = false;
                }
                message = message + "<li>手机号格式错误!</li>";
            }
            if(sCreateTime!='' && eCreateTime!='' && sCreateTime>eCreateTime){
                var check = false;
                message = message + "<li>开始创建时间不能晚于结束创建时间!</li>";
            }
            if(sViewTotal!='' && eViewTotal!='' && eViewTotal>0 && sViewTotal-eViewTotal>0){
                var check = false;
                message = message + "<li>开始浏览数不能大于结束浏览数!</li>";
            }
            if(sLikeTotal!='' && eLikeTotal!='' && eLikeTotal>0 && sLikeTotal-eLikeTotal>0){
                var check = false;
                message = message + "<li>开始喜欢数不能大于结束喜欢数!</li>";
            }
            if(sCommentTotal!='' && eCommentTotal!='' && eCommentTotal>0 && sCommentTotal-eCommentTotal>0){
                var check = false;
                message = message + "<li>开始评论数不能大于结束评论数!</li>";
            }
            if (check == false) {
                $.prompt("<span style=\" color:#AD6C14\">"+message+"</span>", {
                    title: "提示",
                    buttons: {"确定": false}
                });
                return false;
            } else {
                return true;
            }

        }

    </script>
</block>
